version: 2
jobs:
  test_base: &common_test
    docker:
      - image: google/dart:${DART_VERSION}
    steps:
      - checkout
      - run:
          command: |
            ./tool/travis.sh dartanalyzer
          environment:
            PKGS: "example annotation generator"
      - run:
          command: |
            cd generator
            pub get
            pub run test

  test_dart22:
    <<: *common_test
    environment:
      DART_VERSION: "2.2"
  test_dart23:
    <<: *common_test
    environment:
      DART_VERSION: "2.3"
  test_dart24:
    <<: *common_test
    environment:
      DART_VERSION: "2.4"
  test_dart25:
    <<: *common_test
    environment:
      DART_VERSION: "2.5"
  test_dart26:
    <<: *common_test
    environment:
      DART_VERSION: "2.6"
  test_dart27:
    <<: *common_test
    environment:
      DART_VERSION: "2.7"
workflows:
  version: 2
  build_and_test:
    jobs:
      - test_dart22
      - test_dart23
      - test_dart24
      - test_dart25
      - test_dart26
      - test_dart27
